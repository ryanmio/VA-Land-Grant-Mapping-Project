# Virginia Land Grant Atlas

A **static, client-only** interactive atlas of Virginia land grants with buttery-smooth year filtering and optional ±23km radius overlay. Handles ~500k points with GPU-accelerated filtering for optimal performance.

![Virginia Land Grant Atlas](https://via.placeholder.com/800x400?text=Virginia+Land+Grant+Atlas)

## 🚀 Quick Start

```bash
# Clone and setup
git clone <your-repo-url>
cd GrantMap

# Install dependencies (requires Node 20 LTS)
cd frontend && npm install
# or: cd frontend && pnpm install

# Place your data file
# Copy results_full_v2.csv to data/raw/results_full_v2.csv

# Process data and generate tiles (requires Python 3.11 + tippecanoe)
python3 scripts/clean.py
./scripts/make_tiles.sh

# Start development server
npm run dev
```

Open [http://localhost:5173](http://localhost:5173) to view the atlas.

## 📋 Requirements

- **Node.js**: 20 LTS or higher
- **Python**: 3.11 or higher  
- **Tippecanoe**: For PMTiles generation
  ```bash
  # macOS
  brew install tippecanoe
  
  # Linux
  git clone https://github.com/felt/tippecanoe.git
  cd tippecanoe && make && sudo make install
  ```

## 🗂️ Project Structure

```
GrantMap/
├── data/
│   ├── raw/results_full_v2.csv     # Your source data (required)
│   ├── cleaned.geojson             # Generated by clean.py
│   └── grants.pmtiles              # Generated by make_tiles.sh
├── scripts/
│   ├── clean.py                    # CSV → GeoJSON processor
│   └── make_tiles.sh               # Tippecanoe tile generator
├── frontend/                       # Vite + React application
│   ├── src/
│   │   ├── App.tsx                 # Main app with routing
│   │   ├── components/
│   │   │   ├── GrantMap.tsx        # MapLibre + deck.gl map
│   │   │   └── YearSlider.tsx      # Year range slider
│   │   └── index.css               # Styling
│   └── package.json
└── README.md
```

## 🛠️ Data Processing

### 1. Clean Raw Data
```bash
python3 scripts/clean.py
```
- Converts `data/raw/results_full_v2.csv` to `data/cleaned.geojson`
- Validates coordinates (Virginia bounds)
- Extracts year from date fields
- Handles ~500k records efficiently

### 2. Generate PMTiles
```bash
./scripts/make_tiles.sh
```
- Uses tippecanoe with optimized flags: `-zg --drop-densest-as-needed -l grants`
- Outputs `data/grants.pmtiles` (target: <75MB)
- Zoom levels 3-16 for optimal performance

## ⚡ Performance Features

- **GPU Filtering**: Year filtering happens entirely on GPU via `DataFilterExtension`
- **PMTiles**: Efficient vector tile serving without a tile server
- **Optimized Rendering**: Points vs. 23km radius circles with dynamic LOD
- **Smart Caching**: Aggressive tile caching for smooth pan/zoom
- **No Re-renders**: React state changes don't trigger feature array updates

## 🎛️ Features

### Interactive Controls
- **Dual-ended Year Slider**: Filter by year range (1600-2000)
- **Radius Toggle**: Switch between point and ±23km radius view
- **Deep Linking**: Share URLs with current filter state
- **Export**: Download filtered data as GeoJSON

### Map Interaction
- **Hover Tooltips**: Show grant details on hover
- **Smooth Zoom**: 16 zoom levels with optimal tile loading
- **Dark Theme**: CartoDB Dark Matter base map

### URL Parameters
- `yearMin=1650&yearMax=1750` - Set year range
- `rad=true` - Enable radius overlay

Example: `https://your-site.com/?yearMin=1700&yearMax=1800&rad=true`

## 🚀 Deployment

### Build for Production
```bash
cd frontend
npm run build
```

### Deploy to GitHub Pages
1. Push to GitHub
2. Enable GitHub Pages in repository settings
3. Point to `/frontend/dist` folder
4. Ensure `grants.pmtiles` is accessible at `/data/grants.pmtiles`

### Deploy to Netlify/Vercel
```bash
cd frontend
npm run build
# Deploy the dist/ folder
```

### Custom Static Host
- Build produces static files in `frontend/dist/`
- Ensure PMTiles file is served with correct MIME type
- Configure redirects for SPA routing if needed

## 🔧 Development

### Start Dev Server
```bash
cd frontend
npm run dev          # Start on localhost:5173
npm run build        # Build for production
npm run preview      # Preview production build
npm run type-check   # TypeScript checking
```

### Data Updates
1. Update `data/raw/results_full_v2.csv`
2. Run `python3 scripts/clean.py`
3. Run `./scripts/make_tiles.sh`
4. Restart dev server

### Performance Monitoring
- Check browser dev tools for GPU performance
- Monitor tile loading in Network tab
- Use React DevTools for component performance

## 📊 Technical Stack

- **Frontend**: Vite + React 18 + TypeScript
- **Mapping**: deck.gl 8.10 + MapLibre GL 3.6
- **Data**: PMTiles (via loaders.gl)
- **UI**: react-range for sliders
- **Routing**: react-router-dom with query params
- **Build**: Vite with optimized chunks

## 🤝 Contributing

1. Ensure your changes maintain 60fps performance
2. Test with full 500k dataset
3. Verify TypeScript compilation
4. Update docs if adding features

## 📄 License

[Your License Here]

## 🔗 Links

- [deck.gl Documentation](https://deck.gl/)
- [PMTiles Specification](https://github.com/protomaps/PMTiles)
- [Tippecanoe Repository](https://github.com/felt/tippecanoe)
- [MapLibre GL JS](https://maplibre.org/)

---

**Performance Target**: Buttery-smooth 60fps interaction with 500k+ points ✨
